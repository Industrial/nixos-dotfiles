#!/usr/bin/env bash
set -e

source lib/lowercase.bash

HOST=$(lowercase ${1:-"vm"})
echo "bin/update-vm > host: ${HOST}"

# bin/update-nix-env
# bin/update-flake

# bin/update-zellij
# bin/update-nix-env
# bin/update-flake

# Create or update the MicroVM.
if [ ! -d "/var/lib/microvms/${HOST}" ]; then
  echo "bin/update-vm > sudo microvm -f \"git+file://${PWD}\" -c \"${HOST}\""
  sudo microvm -f "git+file://${PWD}" -c "${HOST}"
else
  echo "bin/update-vm > sudo microvm -f \"git+file://${PWD}\" -u \"${HOST}\""
  sudo microvm -f "git+file://${PWD}" -u "${HOST}"
fi

# features/home/programming/vscode/bin/clear-cache
# bin/update-home-manager "${HOST}" "${USER}"
