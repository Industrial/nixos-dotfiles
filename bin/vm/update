#!/usr/bin/env bash
echo "> vm > update"
exec > >(tee ./logs/vm-update) 2>&1
set -e

REPO_PATH="/home/tom/.dotfiles"
GIT_PATH="git+file://${REPO_PATH}?dir=."

# Create or update the MicroVM.
if [ ! -d "/var/lib/microvms/$(hostname)" ]; then
    echo "> sudo microvm -f \"${GIT_PATH}\" -c \"$(hostname)\""
    sudo microvm -f "${GIT_PATH}" -c "$(hostname)"
else
    echo "> sudo microvm -f \"${GIT_PATH}\" -u \"$(hostname)\""
    sudo microvm -f "${GIT_PATH}" -u "$(hostname)"
fi
